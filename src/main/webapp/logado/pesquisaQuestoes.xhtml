<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/layout.xhtml">

    <ui:define name="content">
    
  		<p:messages id="messages" showDetail="true" closable="true" style="margin:0 auto; width: 90%">
			<p:autoUpdate />
		</p:messages>
		
 		<!-- HEADER --> 
        <p:panel id="combo_busca_questao" styleClass="color"  >
	        	<h:form id="formCategoria">
	        		
		        	<div style="width:100vw; display: flex; flex-direction: column;">
			        	<div id="filtros_questao" style="display: flex; justify-content: space-between;">
			        		<!-- CATEGORIA -->
			        		<div id="combo_categoria" style="margin-right: 5px">	        
								 <p:selectOneMenu value="#{categoriaC.categoria.id}"                                                             
					                                 id="categoria"		                                 
					                                 filter="true"
					                                 style="width: 35vw; background: #f2f2f2; border-radius:5px">                                                       
					
					                    <f:selectItem itemLabel="Escolha uma categoria..." itemValue=""/>
					                    <f:selectItems value="#{categoriaC.comboCategorias}" />
					                    <p:ajax update="sub_categoria" listener="#{subcategoriaC.populaComboSubCategorias(categoriaC.categoria)}" />
					                    <p:ajax listener="#{perguntaC.buscaPerguntasComFiltro(categoriaC.categoria.id, perguntaC.subCategoria.id)}" update="form:tabela formCategoria"/>
					            </p:selectOneMenu>
		                    </div>
							<!-- SUB-CATEGORIA -->
							<div id="combo_SubCategoria" style="margin-right: 5px">
								<p:selectOneMenu disabled="#{categoriaC.categoria.id == null ? true : false}" value="#{perguntaC.subCategoria.id}"
					                                 id="sub_categoria"
					                                 filter="true"
					                                 style="width: 35vw; background: #f2f2f2; border-radius:5px">
					
					                    <f:selectItem itemLabel="Escolha uma Subcategoria..." itemValue=""/>
					                    <f:selectItems value="#{subcategoriaC.comboSubcategorias}" />
					                    <p:ajax update="sub_categoria" listener="#{perguntaC.vinculaSubcategoriaComPergunta(perguntaC.subCategoria)}"/>
			                        	<p:ajax listener="#{perguntaC.buscaPerguntasComFiltro(categoriaC.categoria.id, perguntaC.subCategoria.id)}" update="form:tabela"/>
			                    </p:selectOneMenu>
			                </div>
						    <div id="refina_busca" >
					       		<p:inputText disabled="#{categoriaC.categoria.id == null ? true : false}" id="text_busca" value="#{perguntaC.refinaBusca}" placeholder="Refine sua busca"  style="background: #f2f2f2; width: 20vw" filter="true">
					       			<f:validateLength minimum="3"/>
					       			<p:ajax listener="#{perguntaC.buscaPerguntasComFiltro(categoriaC.categoria.id, perguntaC.subCategoria.id)}" update="form:tabela"/>
					       		</p:inputText>
						    </div>
						</div>
						<div style="display:grid;">
							
				        		<p:inputText id="titulo_quiz" value="#{quizC.quiz.titulo}" placeholder="Digite o título do Quiz"  style="background: #f2f2f2" >
						       			<p:ajax listener="#{quizC.quiz.titulo}"/>
						       	</p:inputText>
			        		
						</div>
					</div>     
	        	</h:form>
        </p:panel>
			
		<!-- TABELA -->
			
		<h:form id="form">			
			<p:dataTable id="tabela" var="pergunta" value="#{perguntaC.modelPerguntas}" rows="10"
                         paginator="true" paginatorPosition="bottom"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                         rowsPerPageTemplate="5,10,15,{ShowAll|'Todos'}" 
                         selectionMode="single" selection="#{perguntaC.pergunta}" rowKey="#{pergunta.id}">
                <p:column headerText="PERGUNTAS" style="word-wrap: break-word">
                    <h:outputText value="#{pergunta.texto}" />
                </p:column>
                
               	<f:facet name="footer" >
                 	<div style="display: flex; justify-content: space-around">
		                <p:commandButton process="tabela" update=":form:panelPergunta" icon="pi pi-eye"
		                                 value="Visualizar Questão" styleClass="rounded-button ui-button-outlined"
		                                 oncomplete="PF('modalPergunta').show()"  />
		                                 
		             	<p:commandButton process="tabela" update=":form:panelQuiz" icon="pi pi-eye"
		                                 value="Visualizar Quiz" styleClass="rounded-button ui-button-outlined"
		                                 oncomplete="PF('modalVisualizaQuiz').show()"  />
                           
	                    <!-- Button trigger modal -->
					 	<button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" 
									style="border-radius: 20px; padding: 0 25px">
							<span class="glyphicon glyphicon-envelope"></span>
						  	Cadastrar Quiz
						</button>		               
		            
			    		<!-- MODAL CONFIRMA INCLUSÃO DE QUIZ  -->
				
						<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
						  <div class="modal-dialog">
						    <div class="modal-content">
						      <div class="modal-header">
						        <h5 class="modal-title" id="staticBackdropLabel">Finalizar inclusão de questões?</h5>
						        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						      </div>
						      <div class="modal-body">
						        Clique em cadastrar Quiz e siga para a etapa de envio do Quiz por email
						      </div>
						      <div class="modal-footer" style="display:flex; justify-content: space-around;">
						      	<button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal" style="border-radius: 20px; padding: 7px 25px">
						      		Continuar adicionando
						      		
						      	</button>
						        <p:commandButton icon="pi pi-save" value="Cadastrar Quiz" 
	                                             actionListener="#{quizC.salvarQuiz()}" action="#{quizC.defineFluxo()}"
	                                             styleClass="rounded-button ui-button-outlined" update=":form:panelPergunta" />
						      </div>
						    </div>
						  </div>
						</div>
					</div>
		        </f:facet>
	        </p:dataTable>
	            
		    <!--  MODAL VER QUESTÃO --> 
		    
		    <p:dialog header="PERGUNTA" widgetVar="modalPergunta" modal="true" showEffect="fade"
		              hideEffect="fade" resizable="false" id="modal">			              		                            
		        <p:outputPanel id="panelPergunta" style="text-align:center; width: 88vw; height: 70vh">
		            <p:column rendered="#{not empty perguntaC.pergunta}">
		                <div class="product">
		                    <div class="product-grid-item card" style="margin-bottom: 0">
		                        <div class="product-grid-item-top">
		                            <div id="texto_pergunta_modal" >
		                                <span class="product-category" style="word-wrap: break-word;">#{perguntaC.pergunta.texto}</span>
		                            </div>
		                        </div>
		                    </div>
		                        
	                        <div class="product-grid-item-content">
	                            <div style="text-align: left; margin: 10px 0; font-size: 1.2rem; font-weight: bolder">ALTERNATIVAS</div>
									
									<ui:repeat value="#{perguntaC.pergunta.alternativas}" var="alt" varStatus="status">								
		                                	<p:outputLabel  value="#{status.index+1}"  styleClass="outputLabel" 
		                                			style="text-align: left; float: left; margin-left: 10px; margin-bottom: 15px"> - #{alt.texto}</p:outputLabel><br></br>
		                                
		                            </ui:repeat>									

							</div>
		                </div>
		            </p:column>
		        </p:outputPanel>
		        <div id="botao_seleciona_questao">
			        <p:commandButton value="Usar questão" icon="pi pi-plus" actionListener="#{quizC.incluiPergunta(perguntaC.pergunta)}" update="modal">
                         <f:setPropertyActionListener value="#{perguntaC.pergunta}" target="#{perguntaC.pergunta}" />	                         
                    </p:commandButton>
                   </div>
		    </p:dialog>	
			    
		    <!--  MODAL VISUALIZA QUIZ -->			    

			<p:dialog header="QUIZ" widgetVar="modalVisualizaQuiz" modal="true" showEffect="fade"
	              hideEffect="fade" resizable="false" id="modalQuiz" style="overflow: hidden">
		              
		        <!-- REMOVE QUESTÃO DO MODAL E DA LISTA -->

		        <p:toolbar>
		            <p:toolbarGroup>					                
						<p:commandButton icon="pi pi-trash" value="Remover questão" 
	                                     actionListener="#{quizC.retiraQuestaoVisualizacao()}"
 	                                     styleClass="rounded-button ui-button-outlined" update=":form:panelQuiz"> 
                   			</p:commandButton>
		            </p:toolbarGroup>		            
		        </p:toolbar>
					        
					        
		        <p:dataTable id="panelQuiz" var="questao" value="#{quizC.modelperguntas}"
                  			 rowKey="#{questao.id}"	selection="#{quizC.perguntaSelecionada}" selectionMode="single"
        					 style="text-align:left; width: 88vw; height: 70vh">
       										            
		            <p:column rendered="#{not empty quizC.modelperguntas}" style="margin-top: 20px; ">
		                <div class="product"> 
							<h:outputLabel value="#{questao.texto}" styleClass="outputLabel"
											style="float: left; font-weight:bolder " /><br></br>
							<ui:repeat value="#{questao.alternativas}" var="alt" varStatus="status">
								
                                	<p:outputLabel  value="#{status.index+1}"  styleClass="outputLabel" 
                                			style="justify-content: left; float: left; margin-left: 10px; margin-top: 15px">
                                			 - #{alt.texto}
                                	</p:outputLabel><br></br>
                                
                            </ui:repeat>
		                </div>
		            </p:column> 
		        </p:dataTable>			        		        
	    	</p:dialog>
		</h:form>			
    </ui:define>
</ui:composition>
